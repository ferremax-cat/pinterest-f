<!DOCTYPE html>
<html lang="en">
     # <!-- Versión desarrollo - Última actualización: 21/11/2023 -->
<head>
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Ferremax-Catalogo</title>
     <link rel="stylesheet" href="estilos-copia.css">
     <link rel="stylesheet" href="fontawesome/css/all.min.css">
     <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
     <!-- Agregamos la librería XLSX -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
     <!-- Menu principal -->
     <nav>
          <div class="img-logo">
               <img class="logo" src="img/logo.png" alt="Logo" class="logo">
          </div>
          <a href="login.html" class="btn">Inicio</a>

          <div class="input-container">
               <input type="text" placeholder="Buscar">
               <i class="fas fa-search"></i>
          </div>

          <div class="iconos">
               <span class="fas fa-bell"></span>
               <span class="fas fa-comment"></span>
               <div class="perfil-container">
                    <!--<img class="img-perfil" src="img/perfil.jpg" alt="">-->
               </div>
               <span class="fas fa-angle-down"></span>
          </div>
     </nav>



     <!-- Seccion de imagenes -->
     <section class="gallery-container">



          <div class="gallery-item">
               <div class="container-img">
                    <!--<img src="img/image1.jpg" alt="">-->
                    <img alt="">


                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!-- Seccion de imagenes 
                              <a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                             -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!-- <img src="img/logo-f.png" alt="">
                              -->
                         <a href=""></a>
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji-alerta.svg" alt="">
                         <!--<img src="icons/emoji2.svg" alt="">
                              -->
                         <span></span>
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">

                    <!-- lo cambio para cargar desde google driver
                    <img src="img/image2.jpg" alt=""> -->
                    <img alt=""> <!-- Solo quitamos el src, mantenemos la etiqueta img -->

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>evo115co</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>720</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                   
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">
                    
                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>PERFA0261</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>800</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>2850</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> </a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <span>1000</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> </a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> </a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>321</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> </a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>128</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">
                    <!--<img src="img/image17.jpg" alt="">-->

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>367</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">
                    

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">
                    

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji3.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <span>752</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji3.svg" alt="">
                              <img src="icons/emoji1.svg" alt="">
                              <span>120</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="">

                    <div class="top-row">
                         <a href=""></a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span></a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>321</span>
                              -->
                    </div>
               </div>
          </div>



     </section>




     <!-- Botones inferioes -->
     <div class="btn-inferiores">
          <a href=""><span class="fas fa-plus"></span></a>
          <a href=""><span class="fas fa-question"></span></a>
     </div>

     <!-- Agregar el nuevo script al final -->
     <script type="module">

          import MonitoringSystem from '../js/MonitoringSystem.js';
          import FallbackManager from '../js/FallbackManager.js';
          //import CacheManager from '../js/cacheManager.js';
          import ProductManager from '../js/productManager.js';
          import {config} from '../js/config.js';
          import ImageLoader from '../js/imageLoader.js';

          async function cargarImagenes() {
    try {
        console.log('Iniciando carga de imágenes...');
        let imageMap;

        // 1. Intentar cargar desde localStorage primero
        const cachedData = localStorage.getItem('imageCatalog');
        if (cachedData) {
            try {
                const parsedCache = JSON.parse(cachedData);
                imageMap = parsedCache.images;
                console.log('Imágenes cargadas desde localStorage:', Object.keys(imageMap).length);
            } catch (e) {
                console.warn('Error al parsear datos del localStorage:', e);
            }
        }

        // 2. Si no hay datos en localStorage, cargar desde JSON
        if (!imageMap) {
            console.log('No hay datos en localStorage, cargando desde JSON...');
            const response = await fetch('json/catalogo_imagenes.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const catalogoImagenes = await response.json();
            imageMap = catalogoImagenes.images;
            
            // Guardar en localStorage para próxima carga
            localStorage.setItem('imageCatalog', JSON.stringify(catalogoImagenes));
            console.log('Datos guardados en localStorage para futuro uso');
        }

        // 3. Actualizar las imágenes en la interfaz
        document.querySelectorAll('.gallery-item').forEach(item => {
            const bottomRow = item.querySelector('.bottom-row a');
            if (bottomRow) {
                const codigo = bottomRow.textContent.trim();
                const codigoLimpio = codigo.replace(/\s+/g, '');

                if (imageMap[codigoLimpio]) {
                    const imgUrl = `https://lh3.googleusercontent.com/d/${imageMap[codigoLimpio]}`;
                    const img = item.querySelector('img');
                    if (img) {
                        img.src = imgUrl;
                        console.log(`Imagen actualizada: ${codigoLimpio}`);
                    }
                } else {
                    console.log(`No se encontró ID para el código: ${codigoLimpio}`);
                }
            }
        });

    } catch (error) {
        console.error('Error cargando imágenes:', error);
        // Si hay error total, podríamos implementar otro fallback aquí
    }
}
          // En catalogo.html

          document.addEventListener('DOMContentLoaded', async function() {

               // 1. AGREGAR al inicio la creación del MonitoringSystem
               const monitoringSystem = new MonitoringSystem();
               const fallbackManager = new FallbackManager();
               const startTime = performance.now();

               // 2. LUEGO verificar y obtener clientData
               const clientData = localStorage.getItem('clientData');
               if (!clientData) {
               console.log('No hay datos de cliente, usando modo básico');
               window.location.href = 'login.html';
               return;
               }

               // 3. DESPUÉS parsear clientConfig
               const clientConfig = JSON.parse(clientData);

               // 1. AGREGAR primero la obtención de instancias
               window.productManager = ProductManager.getInstance({ 
               monitoringSystem,
               clientData: clientConfig 
               });

               window.imageLoader = ImageLoader.getInstance({ 
               monitoringSystem,
               sheetId: config.sheetId
               });
               
               // Agregar al inicio del DOMContentLoaded
               const managersInitialized = sessionStorage.getItem('managersInitialized') === 'true';

               // Agregar el control de inicialización
               if (!managersInitialized) {
               console.log('Primera inicialización de managers');
               try {
                    await Promise.all([
                         window.productManager.initialize(clientConfig),
                         window.imageLoader.initialize()
                    ]);
                    sessionStorage.setItem('managersInitialized', 'true');
               } catch (error) {
                    console.error('Error en inicialización de managers:', error);
                    throw error;
               }
               } else {
               console.log('Managers ya inicializados, procediendo con la carga de galería');
               }     


               //-----

               // Parte 2.1: Verificar estado y forzar inicialización si es necesario

               console.log('[DEBUG-INIT] Verificando estado de productManager...');
               console.log('[DEBUG-INIT] Tamaño actual del mapa de productos:', window.productManager.products.size);

               // Comprobar si el sessionStorage está marcando una inicialización exitosa
               // pero en realidad no hay productos cargados
               //const managersInitialized = sessionStorage.getItem('managersInitialized') === 'true';
               const needsReinitialization = managersInitialized && window.productManager.products.size === 0;

               if (needsReinitialization) {
               console.log('[DEBUG-INIT] ADVERTENCIA: sessionStorage indica inicialización pero el mapa está vacío');
               console.log('[DEBUG-INIT] Forzando reinicialización...');
               
               // Borrar la marca de inicialización
               sessionStorage.removeItem('managersInitialized');
               
               // Intentar reinicializar manualmente
               try {
                    const clientConfig = JSON.parse(localStorage.getItem('clientData'));
                    console.log('[DEBUG-INIT] Reinicializando con clientConfig:', clientConfig);
                    
                    // Llamar a initialize directamente
                    await window.productManager.initialize(clientConfig);
                    
                    // Verificar nuevamente
                    console.log('[DEBUG-INIT] Después de reinicialización:', {
                         productsSize: window.productManager.products.size,
                         primeros3: Array.from(window.productManager.products.keys()).slice(0, 3)
                    });
                    
                    // Restaurar la marca de inicialización
                    sessionStorage.setItem('managersInitialized', 'true');
               } catch (error) {
                    console.error('[DEBUG-INIT] Error al reinicializar:', error);
               }
               }

              


               //-----




          try {

                    const monitoringSystem = new MonitoringSystem();
                    const fallbackManager = new FallbackManager();
                    const startTime = performance.now();

               // 1. Verificar autenticación
               const clientData = localStorage.getItem('clientData');
               if (!clientData) {
                    console.log('No hay datos de cliente, usando modo básico');
                    window.location.href = 'login.html';
                    return;
               }

               const clientConfig = JSON.parse(clientData);

               // 2. Obtener instancias únicas de los managers
               /* window.productManager = ProductManager.getInstance({ 
                    monitoringSystem,
                    clientData: clientConfig 
               });
        
               window.imageLoader = ImageLoader.getInstance({ 
               monitoringSystem,
               sheetId: config.sheetId
               }); */




               // 3. Inicializar en orden correcto

               /* await window.productManager.initialize(clientConfig);
               await window.imageLoader.initialize();
               const productManager = window.productManager;
               const imageLoader = window.imageLoader; */

               // 4. Implementar búsqueda
               const searchInput = document.querySelector('input[type="text"]');

               if (searchInput) {
                    searchInput.addEventListener('input', debounce(async function(e) {
                         const searchTerm = e.target.value.toLowerCase();
                         monitoringSystem.trackUsage('search', { term: searchTerm });
                         const items = document.querySelectorAll('.gallery-item');

                         items.forEach(async item => {
                              const bottomRow = item.querySelector('.bottom-row a');
                              if (!bottomRow) return;

                              const codigo = bottomRow.textContent.trim().replace(/\s+/g, '');

                              const codigoMayus = codigo.toUpperCase();
                              console.log('[catalogo-html DEBUG-Precio 1]', {
                              codigoOriginal: codigo,
                              codigoMayus,
                              precio: await productManager.getPrice(codigoMayus)
                              });
                              

                              if (productManager) {
                              // Si existe ProductManager, usar su búsqueda
                              const producto = productManager.getProduct(codigo);
                              if (producto) {
                                   const matchesBusqueda = 
                                        producto.codigo.toLowerCase().includes(searchTerm) ||
                                        producto.nombre.toLowerCase().includes(searchTerm) ||
                                        producto.categoria.toLowerCase().includes(searchTerm);

                                   item.style.display = matchesBusqueda ? '' : 'none';
                              }
                              } else {
                              // Búsqueda básica por código
                              const matchesBusqueda = codigo.toLowerCase().includes(searchTerm);
                              item.style.display = matchesBusqueda ? '' : 'none';
                              }
                         });
                    }, 300));
               }

               // 5. Función original de carga de imágenes
               async function cargarImagenes() {
                    try {

                         console.log('[catalogo.html- cargargarImagenes Precios 1]...metodo cargarImagenes');

                         const sheetId = '1IKRA31nI8N5dABByDoRWen5NbqiNFl2d';
                         const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

                         const response = await fetch(sheetUrl);
                         const text = await response.text();
                         const json = JSON.parse(text.substr(47).slice(0, -2));

                         const imageMap = {};
                         const priceMap = {};
                         json.table.rows.forEach(row => {
                              if (row.c[0]?.v && row.c[1]?.v) {
                              const nombreArchivo = row.c[0].v;
                              const codigo = nombreArchivo.replace(/\.(jpg|webp|png)$/, '');
                              const id = row.c[1].v;
                              const precio = row.c[5]?.v;
                              imageMap[codigo] = id;
                              if (precio) {
                                   priceMap[codigo] = precio;
                              }
                              }
                         });

                         console.log('Items encontrados:', document.querySelectorAll('.gallery-item').length);

                         document.querySelectorAll('.gallery-item').forEach(item => {
                              const bottomRow = item.querySelector('.bottom-row a');

                              console.log('[catalogo.html- cargargarImagenes Precios 1a] [Debug-bottomRow]', {
                              bottomRow,
                              item,
                              tieneBottomRow: !!bottomRow
                              });



                              if (bottomRow) {
                              const codigo = bottomRow.textContent.trim();

                              

                              const codigoLimpio = codigo.replace(/\s+/g, '');

                              if (imageMap[codigoLimpio]) {
                                   const imgUrl = `https://lh3.googleusercontent.com/d/${imageMap[codigoLimpio]}`;
                                   const img = item.querySelector('img');
                                   if (img) {
                                        img.src = imgUrl;
                                   }
                              }

                              //const precio = priceMap[codigoLimpio]; // VIEJO
                              console.log('[catalogo.html- cargargarImagenes Precios 2] Debug precio:', codigoLimpio, productManager.getPrice(codigoLimpio));
                              
                              if (priceMap[codigoLimpio]) {
                                   const precio = productManager.getPrice(codigoLimpio); // NUEVO
                                   const bottomRowDiv = item.querySelector('.bottom-row');
                                   let precioElement = bottomRowDiv.querySelector('.price-tag');
                                   if (!precioElement) {
                                        precioElement = document.createElement('span');
                                        precioElement.className = 'price-tag';
                                        bottomRowDiv.appendChild(precioElement);
                                   }
                                   precioElement.textContent = `$${precio.toLocaleString('es-AR')}`;

                                   console.log('[catalogo.html- cargargarImagenes Precios 3]', {
                                   precio,
                                   elementoCreado: precioElement.textContent,
                                   padreVisible: bottomRowDiv.offsetParent !== null,
                                   elementoVisible: precioElement.offsetParent !== null
                                   });

                              }
                              }
                         });
                    } catch (error) {
                         console.error('Error en carga básica:', error);
                    }
               }

               // 5. Nueva implementación usando managers

               // Función para cargar la galería
               const galleryItems = document.querySelectorAll('.gallery-item');
                    console.log('[Debug-Gallery]', {
                    itemsEncontrados: galleryItems.length,
                    primerItem: galleryItems[0]
                    });
               



               async function cargarGaleria() {
                    try {
                         console.log('Iniciando cargarGaleria');

                         console.log('URL base para imágenes:', 'https://lh3.googleusercontent.com/d/');
                         console.log('Cache actual:', localStorage.getItem('imageCatalog'));

                         // 1. Obtener los códigos permitidos del clientData
                         const clientData = JSON.parse(localStorage.getItem('clientData'));
                         console.log('=== Datos del Cliente ===', {
                         tieneProductCodes: !!clientData?.productCodes,
                         listaPrecio: clientData?.priceList,
                         cantidadProductos: clientData?.productCodes?.length
                         });
                         

                         // 2. Cargar catálogo de imágenes
                         const response = await fetch('/json/catalogo_imagenes.json');
                         const catalogoImagenes = await response.json();
                         console.log('Catálogo de imágenes cargado:', catalogoImagenes);

                         console.log('ClientData en cargarGaleria:', clientData);
                         console.log('Productos permitidos:', clientData?.productCodes);

                         if (!clientData || !clientData.productCodes) {
                         console.error('No hay datos de productos permitidos para el cliente');
                         return;
                         }



                         //parte 1-producto. Obtener los códigos de productos
                         // Solo continuar con los productos permitidos
                         const productosPermitidos = new Set(clientData?.productCodes || []);
                         console.log('Set de productos permitidos:', Array.from(productosPermitidos));

                         // -producto. Obtener todos los elementos de galería
                         const galleryItems = document.querySelectorAll('.gallery-item');
                         console.log(`[DEBUG-P1] Total de elementos en galería: ${galleryItems.length}`);

                         // Convertir el Set a Array para poder iterar por índice
                         const productosPermitidosArray = Array.from(productosPermitidos);

                         // Iterar sobre los elementos de la galería y asignar códigos
                         for (let i = 0; i < galleryItems.length; i++) {
                         const item = galleryItems[i];
                         
                         // Si ya no quedan productos permitidos, ocultar este elemento
                         if (i >= productosPermitidosArray.length) {
                              item.style.display = 'none';
                              continue;
                         }
                         
                         // Obtener el código del producto permitido correspondiente
                         const codigo = productosPermitidosArray[i];
                         const codigoMayus = codigo.toUpperCase();
                         
                         // Marcar el elemento con el código para futuras referencias
                         item.setAttribute('data-product-code', codigo);
                         item.style.display = ''; // Asegurarse de que sea visible
                         
                         // Actualizar el código en bottom-row
                         const bottomRow = item.querySelector('.bottom-row a');
                         if (bottomRow) {
                              // Establecer el código manteniendo el ícono
                              bottomRow.innerHTML = `<span class="icon fas fa-arrow-up"></span>${codigoMayus}`;
                              console.log(`[DEBUG-P1] Asignado código ${codigoMayus} al elemento #${i}`);
                         }
                         }

                         console.log(`[DEBUG-P1] Asignación de códigos completada.`);
                         


                         // Parte producto: Diagnóstico de productManager
                         console.log('[DEBUG-DIAGNÓSTICO] Estado de productManager:', {
                         existe: !!window.productManager,
                         tieneGetProduct: typeof window.productManager.getProduct === 'function',
                         tieneProducts: !!window.productManager.products,
                         productosSize: window.productManager.products instanceof Map ? window.productManager.products.size : 'No es Map'
                         });

                         // Verificar si podemos acceder a los productos directamente
                         if (window.productManager.products instanceof Map) {
                         console.log('[DEBUG-DIAGNÓSTICO] Primeros 3 productos en Map:');
                         let contador = 0;
                         for (const [key, value] of window.productManager.products.entries()) {
                              console.log(`  - ${key}:`, value);
                              contador++;
                              if (contador >= 3) break;
                         }
                         
                         // Verificar específicamente si existe un producto
                         const primerCodigo = Array.from(productosPermitidos)[0].toUpperCase();
                         console.log(`[DEBUG-DIAGNÓSTICO] Verificando si existe ${primerCodigo} en Map:`, window.productManager.products.has(primerCodigo));
                         console.log(`[DEBUG-DIAGNÓSTICO] Producto ${primerCodigo} en Map:`, window.productManager.products.get(primerCodigo));
                         }

                         // Prueba con getProduct para el primer código
                         if (productosPermitidosArray.length > 0) {
                         const primerCodigo = productosPermitidosArray[0].toUpperCase();
                         console.log(`[DEBUG-DIAGNÓSTICO] Intentando getProduct('${primerCodigo}'):`);
                         try {
                              const producto = window.productManager.getProduct(primerCodigo);
                              console.log(`  - Resultado:`, producto);
                         } catch (e) {
                              console.log(`  - Error:`, e);
                         }
                         }

                         console.log('[DEBUG-DIAGNÓSTICO] Diagnóstico completado.');

                         // Parte 1 producto:-fin








                         // Parte 2 producto: Agregar nombres de productos usando getProduct

                         // Iterar sobre los elementos que ya tienen códigos asignados
                         for (let i = 0; i < galleryItems.length; i++) {
                         const item = galleryItems[i];
                         
                         // Si el elemento está oculto, ignorarlo
                         if (item.style.display === 'none') continue;
                         
                         // Obtener el código asignado anteriormente
                         const codigo = item.getAttribute('data-product-code');
                         if (!codigo) continue;
                         
                         const codigoMayus = codigo.toUpperCase();
                         
                         // Intentar obtener el producto usando getProduct
                         const producto = window.productManager.getProduct(codigoMayus);
                         console.log(`[DEBUG-P2] Resultado getProduct(${codigoMayus}):`, producto);
                         
                         // Actualizar el nombre en top-row
                         const topRowLink = item.querySelector('.top-row a');
                         if (topRowLink) {
                              if (producto && producto.nombre) {
                                   topRowLink.textContent = producto.nombre.toLowerCase();
                                   console.log(`[DEBUG-P2] Actualizado nombre para ${codigoMayus} desde getProduct: ${producto.nombre}`);
                              } else {
                                   console.log(`[DEBUG-P2] No se pudo obtener nombre para ${codigoMayus} desde getProduct`);
                              }
                         }
                         }

                         console.log(`[DEBUG-P2] Intento de asignación de nombres completado.`);

                         // Parte 2 producto :-fin

                        




                         // Parte 3: Agregar precios a los productos

                         // Iterar sobre los elementos que ya tienen códigos y nombres asignados
                         for (let i = 0; i < galleryItems.length; i++) {
                         const item = galleryItems[i];
                         
                         // Si el elemento está oculto, ignorarlo
                         if (item.style.display === 'none') continue;
                         
                         // Obtener el código asignado anteriormente
                         const codigo = item.getAttribute('data-product-code');
                         if (!codigo) continue;
                         
                         const codigoMayus = codigo.toUpperCase();
                         
                         // Intentar obtener el precio del producto
                         try {
                              // Intentar primero con getPrice (método oficial)
                              const precio = await window.productManager.getPrice(codigoMayus);
                              console.log(`[DEBUG-PRECIOS] Precio obtenido para ${codigoMayus}:`, precio);
                              
                              if (precio !== null && precio !== undefined) {
                                   // Obtener o crear el elemento para el precio
                                   const bottomRowDiv = item.querySelector('.bottom-row');
                                   if (bottomRowDiv) {
                                        let precioElement = bottomRowDiv.querySelector('.price-tag');
                                        
                                        // Si no existe el elemento para el precio, crearlo
                                        if (!precioElement) {
                                             precioElement = document.createElement('span');
                                             precioElement.className = 'price-tag';
                                             bottomRowDiv.appendChild(precioElement);
                                        }
                                        
                                        // Actualizar el texto del precio
                                        precioElement.textContent = `$${precio.toLocaleString('es-AR')}`;
                                        console.log(`[DEBUG-PRECIOS] Precio mostrado para ${codigoMayus}: $${precio.toLocaleString('es-AR')}`);
                                   }
                              } else {
                                   console.log(`[DEBUG-PRECIOS] No se pudo obtener precio para ${codigoMayus}`);
                                   
                                   // Intentar obtener el precio directamente del producto como alternativa
                                   const producto = window.productManager.products.get(codigoMayus);
                                   if (producto && producto.precio) {
                                        const bottomRowDiv = item.querySelector('.bottom-row');
                                        if (bottomRowDiv) {
                                             let precioElement = bottomRowDiv.querySelector('.price-tag');
                                             if (!precioElement) {
                                             precioElement = document.createElement('span');
                                             precioElement.className = 'price-tag';
                                             bottomRowDiv.appendChild(precioElement);
                                             }
                                             precioElement.textContent = `$${producto.precio.toLocaleString('es-AR')}`;
                                             console.log(`[DEBUG-PRECIOS] Precio (alternativo) mostrado para ${codigoMayus}: $${producto.precio}`);
                                        }
                                   }
                              }
                         } catch (error) {
                              console.log(`[DEBUG-PRECIOS] Error al obtener precio para ${codigoMayus}:`, error);
                         }
                         }

                         console.log(`[DEBUG-PRECIOS] Proceso de asignación de precios completado.`);


                         // Parte 3 producto :-fin




                         // Parte 4: Cargar imágenes de productos

                         async function cargarImagenesProductos() {
                                   console.log('[DEBUG-IMAGENES] Iniciando carga de imágenes...');
                                   
                                   try {
                                        // 1. Intentar cargar el catálogo de imágenes desde JSON
                                        const response = await fetch('/json/catalogo_imagenes.json');
                                        if (!response.ok) {
                                             throw new Error(`Error al cargar catálogo de imágenes: ${response.status}`);
                                        }
                                        
                                        const catalogoImagenes = await response.json();
                                        console.log('[DEBUG-IMAGENES] Catálogo cargado:', {
                                             totalImagenes: Object.keys(catalogoImagenes.images || {}).length,
                                             ejemploImagen: Object.entries(catalogoImagenes.images || {}).slice(0, 1)
                                        });
                                        
                                        // 2. Iterar sobre los elementos de la galería
                                        for (const item of galleryItems) {
                                             // Si el elemento está oculto, saltar
                                             if (item.style.display === 'none') continue;
                                             
                                             // Obtener el código del producto
                                             const codigo = item.getAttribute('data-product-code');
                                             if (!codigo) continue;
                                             
                                             const codigoMayus = codigo.toUpperCase();
                                             const codigoLower = codigo.toLowerCase();
                                             
                                             // Buscar la imagen en el catálogo (probar varias variantes del código)
                                             let imageId = null;
                                             if (catalogoImagenes.images) {
                                                  // Intentar con diferentes formatos de código
                                                  const variantes = [codigo, codigoMayus, codigoLower];
                                                  for (const variante of variantes) {
                                                       if (catalogoImagenes.images[variante]) {
                                                       imageId = catalogoImagenes.images[variante];
                                                       console.log(`[DEBUG-IMAGENES] ID encontrado para ${codigo}:`, imageId);
                                                       break;
                                                       }
                                                  }
                                             }
                                             
                                             // Si encontramos un ID de imagen, actualizar la imagen
                                             if (imageId) {
                                                  const imgElement = item.querySelector('img');
                                                  if (imgElement) {
                                                       // Usar URL directa de Google Drive
                                                       const imgUrl = `https://lh3.googleusercontent.com/d/${imageId}`;
                                                       imgElement.src = imgUrl;
                                                       imgElement.onload = () => console.log(`[DEBUG-IMAGENES] Imagen cargada para ${codigo}`);
                                                       imgElement.onerror = () => console.log(`[DEBUG-IMAGENES] Error al cargar imagen para ${codigo}`);
                                                  }
                                             } else {
                                                  console.log(`[DEBUG-IMAGENES] No se encontró ID para ${codigo}`);
                                             }
                                        }
                                   } catch (error) {
                                        console.error('[DEBUG-IMAGENES] Error al cargar imágenes:', error);
                                        
                                        // Intentar plan B: usar imageLoader si está disponible
                                        if (window.imageLoader) {
                                             console.log('[DEBUG-IMAGENES] Intentando con imageLoader...');
                                             
                                             for (const item of galleryItems) {
                                                  if (item.style.display === 'none') continue;
                                                  
                                                  const codigo = item.getAttribute('data-product-code');
                                                  if (!codigo) continue;
                                                  
                                                  const imgElement = item.querySelector('img');
                                                  if (imgElement) {
                                                       try {
                                                       const url = await window.imageLoader.getImageUrl(codigo, 'desktop');
                                                       if (url) {
                                                            imgElement.src = url;
                                                            console.log(`[DEBUG-IMAGENES] Imagen cargada con imageLoader para ${codigo}`);
                                                       }
                                                       } catch (e) {
                                                       console.log(`[DEBUG-IMAGENES] Error con imageLoader para ${codigo}:`, e);
                                                       }
                                                  }
                                             }
                                        }
                                   }
                                   
                                   console.log('[DEBUG-IMAGENES] Proceso de carga de imágenes completado.');
                         }

                                   // Ejecutar la carga de imágenes
                                   cargarImagenesProductos();     

                         // Parte 4 producto :-fin



                        

                        
                    } catch (error) {
                         console.error('Error general en cargarGaleria:', error);
                    }
               }
               
               
               // 6. Función de precarga de imágenes
               async function precargarSiguientesPaginas() {
                    if (!imageLoader) return;
                    
                    const items = Array.from(document.querySelectorAll('.gallery-item'));
                    const visibleItems = items.filter(item => 
                         item.getBoundingClientRect().top < window.innerHeight * 2
                    );

                    const codigos = visibleItems.map(item => {
                         const bottomRow = item.querySelector('.bottom-row a');
                         return bottomRow ? bottomRow.textContent.trim().replace(/\s+/g, '') : null;
                    }).filter(Boolean);

                    await imageLoader.preloadImages(codigos);
               }

               // 7. Scroll infinito
               let isLoading = false;
               window.addEventListener('scroll', debounce(async function() {
                    if (isLoading) return;

                    const lastItem = document.querySelector('.gallery-item:last-child');
                    if (!lastItem) return;

                    const lastItemRect = lastItem.getBoundingClientRect();
                    if (lastItemRect.bottom < window.innerHeight * 1.5) {
                         isLoading = true;
                         await precargarSiguientesPaginas();
                         isLoading = false;
                    }
               }, 200));

              // 6. Sistemas principal y fallback
               const primarySystem = async () => {
                    try {
                         monitoringSystem.trackPerformance('loadTime', performance.now() - startTime);

                    if (!window.productManager || !window.imageLoader) {
                    throw new Error('Componentes no inicializados');
                    }

               await cargarGaleria();
               monitoringSystem.trackUsage('pageView', { page: 'catalogo' });

               } catch (error) {
               monitoringSystem.trackError(error, 'primarySystem');
               throw error;
               }
               };

               const fallbackSystem = async () => {
                    try {
                         await cargarImagenes();
                         monitoringSystem.trackUsage('pageView', { page: 'catalogo-fallback' });
                    } catch (error) {
                         monitoringSystem.trackError(error, 'fallbackSystem');
                         throw error;
                    }
               };

               // 7. Iniciar carga
               await fallbackManager.manageSystems(primarySystem, fallbackSystem);
                              // 8. Limpieza al cerrar
                              window.addEventListener('beforeunload', () => {
                                   if (window.imageLoader) {
                                        window.imageLoader.cleanup();
                                   }
                                   monitoringSystem.trackUsage('pageClose', {
                                        duration: performance.now() - startTime
                              });
                         });
                         


          } catch (error) {
               console.error('Error en inicialización:', error);
               // Si todo falla, intentar carga básica
               await cargarImagenes();
          }
          });

          // Utilidad debounce
          function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
               const later = () => {
                    clearTimeout(timeout);
                    func(...args);
               };
               clearTimeout(timeout);
               timeout = setTimeout(later, wait);
          };
          }

     </script>



</body>

</html>