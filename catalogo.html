<!DOCTYPE html>
<html lang="en">
     # <!-- Versión desarrollo - Última actualización: 21/11/2023 -->
<head>
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Pinterest</title>
     <link rel="stylesheet" href="estilos-copia.css">
     <link rel="stylesheet" href="fontawesome/css/all.min.css">
     <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
     <!-- Agregamos la librería XLSX -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
     <!-- Menu principal -->
     <nav>
          <div class="img-logo">
               <img class="logo" src="img/logo.png" alt="Logo" class="logo">
          </div>
          <a href="login.html" class="btn">Inicio</a>

          <div class="input-container">
               <input type="text" placeholder="Buscar">
               <i class="fas fa-search"></i>
          </div>

          <div class="iconos">
               <span class="fas fa-bell"></span>
               <span class="fas fa-comment"></span>
               <div class="perfil-container">
                    <!--<img class="img-perfil" src="img/perfil.jpg" alt="">-->
               </div>
               <span class="fas fa-angle-down"></span>
          </div>
     </nav>



     <!-- Seccion de imagenes -->
     <section class="gallery-container">



          <div class="gallery-item">
               <div class="container-img">
                    <!--<img src="img/image1.jpg" alt="">-->
                    <img alt="Destornillador phillips">


                    <div class="top-row">
                         <a href="">Destornillador phillips</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol5530</a>
                         <!-- Seccion de imagenes 
                              <a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                             -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!-- <img src="img/logo-f.png" alt="">
                              -->
                         <a href="">OFERTA: MEDIDA (5x100)</a>
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji-alerta.svg" alt="">
                         <!--<img src="icons/emoji2.svg" alt="">
                              -->
                         <span>$ 1783</span>
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">

                    <!-- lo cambio para cargar desde google driver
                    <img src="img/image2.jpg" alt=""> -->
                    <img alt="Disco diamantado continuo"> <!-- Solo quitamos el src, mantenemos la etiqueta img -->

                    <div class="top-row">
                         <a href="">Disco diamantado continuo</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>evo115co</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>720</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                   
                    <img alt="anteojo policarbonato">

                    <div class="top-row">
                         <a href="">anteojo policarbonato</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol3210</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="Lapiz carpintero">
                    
                    <div class="top-row">
                         <a href="">Lapiz carpintero</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol1361</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="Soporte para pantalla">

                    <div class="top-row">
                         <a href="">Soporte para pantalla</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol3089</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img alt="Disco flap">

                    <div class="top-row">
                         <a href="">Disco flap</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol2205</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Mecha para farol a gas">

                    <div class="top-row">
                         <a href="">Mecha para farol a gas</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>evol0174</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img alt="Cepillo acero con cabo">

                    <div class="top-row">
                         <a href="">Cepillo acero con cabo</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0330</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Tijera corta caño">

                    <div class="top-row">
                         <a href="">Tijera corta caño</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol1000</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Vidrio para mascara soldar">

                    <div class="top-row">
                         <a href="">Vidrio para mascara soldar</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0177</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>800</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Tacha bronceada">

                    <div class="top-row">
                         <a href="">Tacha bronceada</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol3970</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>2850</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Cepillo de bronce">

                    <div class="top-row">
                         <a href="">Cepillo de bronce</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>evol0088</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Arco acero puño pvc">

                    <div class="top-row">
                         <a href="">Arco acero puño pvc</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0111</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <span>1000</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Disco sierra circular">

                    <div class="top-row">
                         <a href="">Disco sierra circular</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0435</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="cierre vaiven a rodillo">

                    <div class="top-row">
                         <a href="">cierre vaiven a rodillo</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0107</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>321</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Candado dorado">

                    <div class="top-row">
                         <a href="">Candado dorado</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol2530</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>128</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Grampa para engrampadora">
                    <!--<img src="img/image17.jpg" alt="">-->

                    <div class="top-row">
                         <a href="">Grampa para engrampadora</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span>evol0070</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Acople rapido">

                    <div class="top-row">
                         <a href="">Acople rapido</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evorieg153</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Trampa para laucha">

                    <div class="top-row">
                         <a href="">Trampa para laucha</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol3510</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Martillo galponero">

                    <div class="top-row">
                         <a href="">Martillo galponero</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0028</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>367</span>
                              -->
                    </div>
               </div>
          </div>



          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="Disco diamantado Turbo">
                    

                    <div class="top-row">
                         <a href="">Disco diamantado Turbo</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evo115tu</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    <img  alt="fondo de pantalla">
                    

                    <div class="top-row">
                         <a href="">Fondo de pantalla</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol115la</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji3.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <span>752</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    

                    <div class="top-row">
                         <a href="">Llave mandril 13mm</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol1970</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji3.svg" alt="">
                              <img src="icons/emoji1.svg" alt="">
                              <span>120</span>
                              -->
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    

                    <div class="top-row">
                         <a href="">anteojo regulable</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol3245</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                    </div>

                    <div class="reactions">
                    </div>
               </div>
          </div>

          <div class="gallery-item">
               <div class="container-img">
                    

                    <div class="top-row">
                         <a href="">Arco sierra junior</a>
                         <!--<span class="fas fa-chevron-down"></span>
                              <a href="" class="btn">Guardar</a>
                              -->
                    </div>

                    <div class="bottom-row">
                         <a href=""><span class="icon fas fa-arrow-up"></span> evol0025</a>
                         <!--<a href=""><span class="fas fa-upload"></span></a>
                              <a href=""><span class="fas fa-ellipsis-h"></span></a>
                              -->
                    </div>
               </div>
               <div class="info-img">
                    <div class="info">
                         <!--<img src="img/perfil.jpg" alt="">
                              <a href="">Jorge Durand</a>
                              -->
                    </div>

                    <div class="reactions">
                         <!--<img src="icons/emoji1.svg" alt="">
                              <img src="icons/emoji2.svg" alt="">
                              <img src="icons/emoji4.svg" alt="">
                              <img src="icons/emoji5.svg" alt="">
                              <span>321</span>
                              -->
                    </div>
               </div>
          </div>



     </section>




     <!-- Botones inferioes -->
     <div class="btn-inferiores">
          <a href=""><span class="fas fa-plus"></span></a>
          <a href=""><span class="fas fa-question"></span></a>
     </div>

     <!-- Agregar el nuevo script al final -->
     <script type="module">

          import MonitoringSystem from '../js/MonitoringSystem.js';
          import FallbackManager from '../js/FallbackManager.js';
          import CacheManager from '../js/cacheManager.js';
          import ProductManager from '../js/productManager.js';
          import {config} from '../js/config.js';
          import ImageLoader from '../js/imageLoader.js';

          async function cargarImagenes() {
               try {
                    console.log('Iniciando carga de imágenes...');

                    const sheetId = '1IKRA31nI8N5dABByDoRWen5NbqiNFl2d';
                    const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

                    const response = await fetch(sheetUrl);
                    const text = await response.text();
                    const json = JSON.parse(text.substr(47).slice(0, -2));

                    // Creación del mapa de imágenes y precios
                    const imageMap = {};
                    const priceMap = {};
                    json.table.rows.forEach(row => {
                         if (row.c[0]?.v && row.c[1]?.v) {
                              const nombreArchivo = row.c[0].v;
                              const codigo = nombreArchivo.replace(/\.(jpg|webp|png)$/, '');
                              const id = row.c[1].v;
                              const precio = row.c[5]?.v; // Cambiado a índice 5 para columna F
                              imageMap[codigo] = id;
                              if (precio) {
                              priceMap[codigo] = precio;
                              }
                              console.log(`Mapeado: ${nombreArchivo} -> ${id}, código limpio: ${codigo}, precio: ${precio}`);
                         }
                    });

                    console.log('Mapa final:', imageMap);
                    console.log('Mapa de precios:', priceMap);

                    // Procesamiento de imágenes y precios
                    document.querySelectorAll('.gallery-item').forEach(item => {
                         const bottomRow = item.querySelector('.bottom-row a');
                         if (bottomRow) {
                              // Extraer el código exactamente como aparece en el HTML
                              const codigo = bottomRow.textContent.trim();
                              console.log('Texto extraído del HTML:', codigo);

                              // Eliminar cualquier espacio en blanco y saltos de línea
                              const codigoLimpio = codigo.replace(/\s+/g, '');
                              console.log('Código limpio:', codigoLimpio);

                              // Actualizar imagen
                              if (imageMap[codigoLimpio]) {
                                   const imgUrl = `https://lh3.googleusercontent.com/d/${imageMap[codigoLimpio]}`;
                                   const img = item.querySelector('img');
                                   if (img) {
                                        img.src = imgUrl;
                                        console.log(`Imagen actualizada: ${codigoLimpio} -> ${imgUrl}`);
                                   }
                              } else {
                                   console.log(`No se encontró ID para el código: ${codigoLimpio}`);
                              }
                              // Agregar precio
                               if (priceMap[codigoLimpio]) {
                                   const precio = priceMap[codigoLimpio];
                                   const bottomRowDiv = item.querySelector('.bottom-row');
                                   // Verificar si ya existe un elemento de precio
                                   let precioElement = bottomRowDiv.querySelector('.price-tag');
                                   if (!precioElement) {
                                        precioElement = document.createElement('span');
                                        precioElement.className = 'price-tag';
                                        bottomRowDiv.appendChild(precioElement);
                                   }
                                   precioElement.textContent = `$${precio.toLocaleString()}`;
                                   console.log(`Precio agregado: ${codigoLimpio} -> $${precio}`);
                              }
                         }     
                    });
               } catch (error) {
                    console.error('Error:', error);
               }
          }

          // En catalogo.html

          document.addEventListener('DOMContentLoaded', async function() {
          try {

                    const monitoringSystem = new MonitoringSystem();
                    const fallbackManager = new FallbackManager();
                    const startTime = performance.now();

               // 1. Verificar autenticación
               const clientData = localStorage.getItem('clientData');
               if (!clientData) {
                    console.log('No hay datos de cliente, usando modo básico');
                    window.location.href = 'login.html';
                    return;
               }

               const clientConfig = JSON.parse(clientData);
               const cacheManager = new CacheManager();
                     window.productManager = new ProductManager({ 
                            cacheManager: cacheManager,
                            clientData: clientConfig 
                            });
                     window.imageLoader = new ImageLoader({ 
                            cacheManager: cacheManager,
                            sheetId: config.sheetId
                            });




               // 2. Verificar instancias activas

               await window.productManager.initialize(clientConfig);
               await window.imageLoader.initialize();
               const productManager = window.productManager;
               const imageLoader = window.imageLoader;

               // 3. Implementar búsqueda
               const searchInput = document.querySelector('input[type="text"]');
               if (searchInput) {
                    searchInput.addEventListener('input', debounce(async function(e) {
                         const searchTerm = e.target.value.toLowerCase();
                         monitoringSystem.trackUsage('search', { term: searchTerm });
                         const items = document.querySelectorAll('.gallery-item');

                         items.forEach(async item => {
                              const bottomRow = item.querySelector('.bottom-row a');
                              if (!bottomRow) return;

                              const codigo = bottomRow.textContent.trim().replace(/\s+/g, '');
                              
                              if (productManager) {
                              // Si existe ProductManager, usar su búsqueda
                              const producto = productManager.getProduct(codigo);
                              if (producto) {
                                   const matchesBusqueda = 
                                        producto.codigo.toLowerCase().includes(searchTerm) ||
                                        producto.nombre.toLowerCase().includes(searchTerm) ||
                                        producto.categoria.toLowerCase().includes(searchTerm);

                                   item.style.display = matchesBusqueda ? '' : 'none';
                              }
                              } else {
                              // Búsqueda básica por código
                              const matchesBusqueda = codigo.toLowerCase().includes(searchTerm);
                              item.style.display = matchesBusqueda ? '' : 'none';
                              }
                         });
                    }, 300));
               }

               // 4. Función original de carga de imágenes
               async function cargarImagenes() {
                    try {
                         const sheetId = '1IKRA31nI8N5dABByDoRWen5NbqiNFl2d';
                         const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

                         const response = await fetch(sheetUrl);
                         const text = await response.text();
                         const json = JSON.parse(text.substr(47).slice(0, -2));

                         const imageMap = {};
                         const priceMap = {};
                         json.table.rows.forEach(row => {
                              if (row.c[0]?.v && row.c[1]?.v) {
                              const nombreArchivo = row.c[0].v;
                              const codigo = nombreArchivo.replace(/\.(jpg|webp|png)$/, '');
                              const id = row.c[1].v;
                              const precio = row.c[5]?.v;
                              imageMap[codigo] = id;
                              if (precio) {
                                   priceMap[codigo] = precio;
                              }
                              }
                         });

                         document.querySelectorAll('.gallery-item').forEach(item => {
                              const bottomRow = item.querySelector('.bottom-row a');
                              if (bottomRow) {
                              const codigo = bottomRow.textContent.trim();
                              const codigoLimpio = codigo.replace(/\s+/g, '');

                              if (imageMap[codigoLimpio]) {
                                   const imgUrl = `https://lh3.googleusercontent.com/d/${imageMap[codigoLimpio]}`;
                                   const img = item.querySelector('img');
                                   if (img) {
                                        img.src = imgUrl;
                                   }
                              }

                              if (priceMap[codigoLimpio]) {
                                   const precio = priceMap[codigoLimpio];
                                   const bottomRowDiv = item.querySelector('.bottom-row');
                                   let precioElement = bottomRowDiv.querySelector('.price-tag');
                                   if (!precioElement) {
                                        precioElement = document.createElement('span');
                                        precioElement.className = 'price-tag';
                                        bottomRowDiv.appendChild(precioElement);
                                   }
                                   precioElement.textContent = `$${precio.toLocaleString()}`;
                              }
                              }
                         });
                    } catch (error) {
                         console.error('Error en carga básica:', error);
                    }
               }

               // 5. Nueva implementación usando managers
               async function cargarGaleria() {
                    try {
                         const galleryItems = document.querySelectorAll('.gallery-item');
                         const clientConfig = JSON.parse(clientData);

                         
                        
                        
                        
                        
                        
                         for (const item of galleryItems) {
                              const bottomRow = item.querySelector('.bottom-row a');
                              if (!bottomRow) continue;

                              const codigoLimpio = bottomRow.textContent.trim().replace(/\s+/g, '');
                              
                              const imgUrl = imageLoader.getImageUrl(codigoLimpio, 'desktop');
                              if (imgUrl) {
                              const img = item.querySelector('img');
                              if (img) {
                                   img.src = imgUrl;
                              }
                              }

                              const precio = await productManager.getPrice(codigoLimpio);
                              if (precio !== null) {
                              const bottomRowDiv = item.querySelector('.bottom-row');
                              let precioElement = bottomRowDiv.querySelector('.price-tag');
                              if (!precioElement) {
                                   precioElement = document.createElement('span');
                                   precioElement.className = 'price-tag';
                                   bottomRowDiv.appendChild(precioElement);
                              }
                              precioElement.textContent = `$${precio.toLocaleString()}`;
                              }
                         }
                    } catch (error) {
                         console.error('Error en cargarGaleria:', error);
                         // Si falla la nueva implementación, usar la original
                         await cargarImagenes();
                    }
               }

               // 6. Función de precarga de imágenes
               async function precargarSiguientesPaginas() {
                    if (!imageLoader) return;
                    
                    const items = Array.from(document.querySelectorAll('.gallery-item'));
                    const visibleItems = items.filter(item => 
                         item.getBoundingClientRect().top < window.innerHeight * 2
                    );

                    const codigos = visibleItems.map(item => {
                         const bottomRow = item.querySelector('.bottom-row a');
                         return bottomRow ? bottomRow.textContent.trim().replace(/\s+/g, '') : null;
                    }).filter(Boolean);

                    await imageLoader.preloadImages(codigos);
               }

               // 7. Scroll infinito
               let isLoading = false;
               window.addEventListener('scroll', debounce(async function() {
                    if (isLoading) return;

                    const lastItem = document.querySelector('.gallery-item:last-child');
                    if (!lastItem) return;

                    const lastItemRect = lastItem.getBoundingClientRect();
                    if (lastItemRect.bottom < window.innerHeight * 1.5) {
                         isLoading = true;
                         await precargarSiguientesPaginas();
                         isLoading = false;
                    }
               }, 200));

              // 6. Sistemas principal y fallback
               const primarySystem = async () => {
                    try {
                         monitoringSystem.trackPerformance('loadTime', performance.now() - startTime);

                    if (!window.productManager || !window.imageLoader) {
                    throw new Error('Componentes no inicializados');
                    }

               await cargarGaleria();
               monitoringSystem.trackUsage('pageView', { page: 'catalogo' });

               } catch (error) {
               monitoringSystem.trackError(error, 'primarySystem');
               throw error;
               }
               };

               const fallbackSystem = async () => {
                    try {
                         await cargarImagenes();
                         monitoringSystem.trackUsage('pageView', { page: 'catalogo-fallback' });
                    } catch (error) {
                         monitoringSystem.trackError(error, 'fallbackSystem');
                         throw error;
                    }
               };

               // 7. Iniciar carga
               await fallbackManager.manageSystems(primarySystem, fallbackSystem);
                              // 8. Limpieza al cerrar
                              window.addEventListener('beforeunload', () => {
                                   if (window.imageLoader) {
                                        window.imageLoader.cleanup();
                                   }
                                   monitoringSystem.trackUsage('pageClose', {
                                        duration: performance.now() - startTime
                              });
                         });
                         


          } catch (error) {
               console.error('Error en inicialización:', error);
               // Si todo falla, intentar carga básica
               await cargarImagenes();
          }
          });

          // Utilidad debounce
          function debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
               const later = () => {
                    clearTimeout(timeout);
                    func(...args);
               };
               clearTimeout(timeout);
               timeout = setTimeout(later, wait);
          };
          }

     </script>



</body>

</html>